<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Simulasi Tabungan Berjangka</title>
  <style>
    :root{
      --brand:#0066cc;
      --brand-dark:#004999;
      --bg:#f5f7fb;
      --card:#ffffff;
      --muted:#6b7280;
      --border:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      background:var(--bg);
      color:#111827;
    }
    header{
      background:var(--brand);
      color:#fff;
      padding:16px 20px;
      text-align:center;
    }
    main{
      max-width:1100px;
      margin:24px auto 56px;
      padding:0 16px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:12px;
      box-shadow:0 6px 14px rgba(0,0,0,.06);
      padding:18px;
    }

    /* Step chooser */
    .chooser{
      display:grid;
      gap:16px;
      grid-template-columns:repeat(1, minmax(0,1fr));
    }
    @media (min-width:700px){
      .chooser{grid-template-columns:repeat(3, minmax(0,1fr));}
    }
    .product{
      border:1px solid var(--border);
      border-radius:12px;
      padding:16px;
      cursor:pointer;
      transition:transform .08s ease, box-shadow .12s ease, border-color .12s ease;
      user-select:none;
      background:#fff;
    }
    .product:hover{
      transform:translateY(-2px);
      box-shadow:0 8px 20px rgba(0,0,0,.08);
      border-color:#d1d5db;
    }
    .product h3{
      margin:0 0 6px;
      color:var(--brand);
      font-size:1.05rem;
    }
    .product .meta{
      color:var(--muted);
      font-size:.9rem;
    }
    .hidden{display:none !important;}

    /* Forms */
    .form-wrap{
      display:grid;
      gap:18px;
    }
    .row{
      display:grid;
      gap:12px;
      grid-template-columns:1fr;
    }
    @media(min-width:700px){
      .row.two{grid-template-columns:1fr 1fr;}
      .row.three{grid-template-columns:1fr 1fr 1fr;}
    }
    label{
      display:block;
      font-weight:600;
      margin-bottom:6px;
    }
    select, input[type="text"]{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--border);
      border-radius:10px;
      font-size:1rem;
      background:#fff;
      outline:none;
    }
    select:focus, input[type="text"]:focus{
      border-color:var(--brand);
      box-shadow:0 0 0 3px rgba(0,102,204,.12);
    }
    .actions{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .btn{
      appearance:none; border:0; border-radius:10px;
      padding:10px 14px; font-weight:600; cursor:pointer;
      transition:background .15s ease, opacity .15s ease, transform .02s ease;
    }
    .btn-primary{ background:var(--brand); color:#fff; }
    .btn-primary:hover{ background:var(--brand-dark);}
    .btn-ghost{ background:#fff; border:1px solid var(--border); color:#111827;}
    .btn-ghost:hover{ background:#f9fafb;}
    .muted{ color:var(--muted); }

    /* Results */
    .result{
      margin-top:14px;
      padding:14px;
      background:#eef6ff;
      border:1px solid #cfe7ff;
      border-radius:10px;
      overflow:auto;
    }
    .summary{
      display:grid; gap:8px;
      grid-template-columns:repeat(1,minmax(0,1fr));
    }
    @media(min-width:900px){ .summary{grid-template-columns:repeat(4,minmax(0,1fr));}}
    .pill{
      background:#fff; border:1px solid #dbeafe; border-radius:10px; padding:10px 12px;
    }
    .pill b{ display:block; font-size:.95rem; color:#0f172a; }
    .pill span{ color:#334155; font-size:.9rem; }

    table{
      width:100%; border-collapse:collapse; margin-top:12px; font-size:.95rem;
      background:#fff; border:1px solid var(--border); border-radius:10px; overflow:hidden;
    }
    thead th{
      position:sticky; top:0; background:var(--brand); color:#fff; padding:8px; text-align:center;
    }
    tbody td{
      border-top:1px solid var(--border); padding:8px; text-align:right;
    }
    tbody td:first-child, thead th:first-child{ text-align:center;}
    .footer-note{ margin-top:10px; font-size:.9rem; color:#475569; }

    .header-flex{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Simulasi Tabungan Berjangka</h1>
  </header>
  <main>
    <!-- STEP 1: PILIH PRODUK -->
    <section id="step-choose" class="card">
      <div class="header-flex">
        <h2 style="margin:0">Pilih Jenis Tabungan</h2>
        <span class="muted">Mulai dengan memilih salah satu produk di bawah</span>
      </div>
      <div class="chooser">
        <div class="product" onclick="selectProduct('cordelia')">
          <h3>Cordelia Ceremony</h3>
          <div class="meta">Tenor 1–3 tahun • Bunga 1% p.a.</div>
        </div>
        <div class="product" onclick="selectProduct('elara')">
          <h3>Tabungan Elara (Tanpa Setoran Awal)</h3>
          <div class="meta">Tenor 1–5 tahun • Bunga 4% p.a.</div>
        </div>
        <div class="product" onclick="selectProduct('elaraAwal')">
          <h3>Tabungan Elara (Dengan Setoran Awal)</h3>
          <div class="meta">Tenor 1–5 tahun • Bunga 5% p.a.</div>
        </div>
      </div>
    </section>

    <!-- STEP 2: FORM PRODUK (hanya 1 yang terlihat) -->
    <section id="form-cordelia" class="card hidden" aria-hidden="true">
      <div class="header-flex">
        <h2 style="margin:0">Cordelia Ceremony</h2>
        <button class="btn btn-ghost" onclick="backToChoose()">← Kembali</button>
      </div>
      <div class="form-wrap">
        <div class="row two">
          <div>
            <label for="cordelia-tenor">Jangka Waktu</label>
            <select id="cordelia-tenor">
              <option value="1">1 Tahun</option>
              <option value="2">2 Tahun</option>
              <option value="3">3 Tahun</option>
            </select>
          </div>
          <div>
            <label for="cordelia-setoran">Setoran per Bulan</label>
            <input type="text" id="cordelia-setoran" inputmode="numeric" placeholder="contoh: 1.000.000" class="thousand"/>
          </div>
        </div>
        <div class="actions">
          <button class="btn btn-primary" id="btn-cordelia">Hitung</button>
          <span class="muted">Bunga dihitung dan dipajaki setiap bulan (pajak 20%).</span>
        </div>
        <div id="cordelia-result" class="result hidden"></div>
      </div>
    </section>

    <section id="form-elara" class="card hidden" aria-hidden="true">
      <div class="header-flex">
        <h2 style="margin:0">Tabungan Elara (Tanpa Setoran Awal)</h2>
        <button class="btn btn-ghost" onclick="backToChoose()">← Kembali</button>
      </div>
      <div class="form-wrap">
        <div class="row two">
          <div>
            <label for="elara-tenor">Jangka Waktu</label>
            <select id="elara-tenor">
              <option value="1">1 Tahun</option>
              <option value="2">2 Tahun</option>
              <option value="3">3 Tahun</option>
              <option value="4">4 Tahun</option>
              <option value="5">5 Tahun</option>
            </select>
          </div>
          <div>
            <label for="elara-setoran">Setoran per Bulan</label>
            <input type="text" id="elara-setoran" inputmode="numeric" placeholder="contoh: 1.000.000" class="thousand"/>
          </div>
        </div>
        <div class="actions">
          <button class="btn btn-primary" id="btn-elara">Hitung</button>
          <span class="muted">Bunga dihitung dan dipajaki setiap bulan (pajak 20%).</span>
        </div>
        <div id="elara-result" class="result hidden"></div>
      </div>
    </section>

    <section id="form-elaraAwal" class="card hidden" aria-hidden="true">
      <div class="header-flex">
        <h2 style="margin:0">Tabungan Elara (Dengan Setoran Awal)</h2>
        <button class="btn btn-ghost" onclick="backToChoose()">← Kembali</button>
      </div>
      <div class="form-wrap">
        <div class="row three">
          <div>
            <label for="elaraAwal-tenor">Jangka Waktu</label>
            <select id="elaraAwal-tenor">
              <option value="1">1 Tahun</option>
              <option value="2">2 Tahun</option>
              <option value="3">3 Tahun</option>
              <option value="4">4 Tahun</option>
              <option value="5">5 Tahun</option>
            </select>
          </div>
          <div>
            <label for="elaraAwal-setoranAwal">Setoran Awal</label>
            <input type="text" id="elaraAwal-setoranAwal" inputmode="numeric" placeholder="contoh: 5.000.000" class="thousand"/>
          </div>
          <div>
            <label for="elaraAwal-setoran">Setoran per Bulan</label>
            <input type="text" id="elaraAwal-setoran" inputmode="numeric" placeholder="contoh: 1.000.000" class="thousand"/>
          </div>
        </div>
        <div class="actions">
          <button class="btn btn-primary" id="btn-elaraAwal">Hitung</button>
          <span class="muted">Bunga dihitung dan dipajaki setiap bulan (pajak 20%).</span>
        </div>
        <div id="elaraAwal-result" class="result hidden"></div>
      </div>
    </section>
  </main>

  <script>
    /********
     * UTILITAS UMUM
     ********/
    const formatID = n => new Intl.NumberFormat('id-ID').format(n ?? 0);
    const formatRupiah = n => "Rp " + formatID(Math.round(n ?? 0));
    const onlyDigits = s => (s ?? "").toString().replace(/\D+/g, "");
    const parseThousandInput = (el) => {
      // Ambil angka murni dari input berformat ribuan
      const val = onlyDigits(el.value);
      return Number(val || 0);
    };
    const applyThousandFormat = (el) => {
      const digits = onlyDigits(el.value);
      el.value = digits ? formatID(Number(digits)) : "";
    };
    const attachThousandHandlers = () => {
      document.querySelectorAll('input.thousand').forEach(el => {
        el.addEventListener('input', () => applyThousandFormat(el));
        el.addEventListener('blur', () => applyThousandFormat(el));
        el.addEventListener('focus', () => {
          // opsional: tetap tampil dengan format saat focus
        });
      });
    };

    const show = (id) => document.getElementById(id).classList.remove('hidden');
    const hide = (id) => document.getElementById(id).classList.add('hidden');
    const clearNode = (node) => node && (node.innerHTML = "");

    /********
     * NAVIGASI STEP
     ********/
    function selectProduct(key){
      hide('step-choose');
      ['form-cordelia','form-elara','form-elaraAwal'].forEach(hide);
      const map = {
        cordelia:'form-cordelia',
        elara:'form-elara',
        elaraAwal:'form-elaraAwal'
      };
      show(map[key]);
      // reset hasil saat buka form
      ['cordelia-result','elara-result','elaraAwal-result'].forEach(id=>{
        hide(id);
        clearNode(document.getElementById(id));
      });
      // fokus ke input pertama yang ada
      setTimeout(()=>{
        const frm = document.getElementById(map[key]);
        const first = frm.querySelector('input.thousand, select');
        if(first) first.focus();
      }, 10);
    }
    function backToChoose(){
      ['form-cordelia','form-elara','form-elaraAwal'].forEach(hide);
      show('step-choose');
    }

    /********
     * PERHITUNGAN
     * - Bunga tahunan -> dibagi 12 untuk bunga bulanan
     * - Pajak 20% dipotong dari bunga setiap bulan
     * - Setoran masuk terlebih dulu, lalu bunga bulan itu dihitung atas saldo berjalan
     ********/
    function simulasiBulanan({setoranBulanan, tenorTahun, bungaTahunan, setoranAwal=0}){
      const months = tenorTahun * 12;
      const rMonthly = bungaTahunan / 12; // mis. 0.04/12
      const pajak = 0.20;

      let saldo = Number(setoranAwal || 0);
      let totalSetoran = Number(setoranAwal || 0);
      let totalBungaKotor = 0;
      let totalPajak = 0;
      let totalBungaBersih = 0;

      const rows = [];
      for (let i = 1; i <= months; i++){
        // setoran bulan ini
        saldo += setoranBulanan;
        totalSetoran += setoranBulanan;

        // bunga kotor bulan ini
        const bungaKotor = saldo * rMonthly;
        const pajakBulan = bungaKotor * pajak;
        const bungaBersih = bungaKotor - pajakBulan;

        // update saldo
        saldo += bungaBersih;

        totalBungaKotor += bungaKotor;
        totalPajak += pajakBulan;
        totalBungaBersih += bungaBersih;

        rows.push({
          bulan: i,
          setoran: setoranBulanan,
          bungaBersih,
          saldo
        });
      }

      return {
        rows,
        ringkasan:{
          totalSetoran,
          totalBungaKotor,
          totalPajak,
          totalBungaBersih,
          saldoAkhir: saldo
        }
      };
    }

    function renderTabel(container, rows, ringkasan){
      container.innerHTML = `
        <div class="summary">
          <div class="pill"><b>Total Setoran</b><span>${formatRupiah(ringkasan.totalSetoran)}</span></div>
          <div class="pill"><b>Total Bunga Kotor</b><span>${formatRupiah(ringkasan.totalBungaKotor)}</span></div>
          <div class="pill"><b>Total Pajak (20%)</b><span>${formatRupiah(ringkasan.totalPajak)}</span></div>
          <div class="pill"><b>Saldo Akhir</b><span>${formatRupiah(ringkasan.saldoAkhir)}</span></div>
        </div>
        <table>
          <thead>
            <tr>
              <th>Bulan</th>
              <th>Setoran</th>
              <th>Bunga Bersih</th>
              <th>Saldo Akhir</th>
            </tr>
          </thead>
          <tbody>
            ${rows.map(r => `
              <tr>
                <td>${r.bulan}</td>
                <td>${formatRupiah(r.setoran)}</td>
                <td>${formatRupiah(r.bungaBersih)}</td>
                <td>${formatRupiah(r.saldo)}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
        <div class="footer-note">Catatan: bunga tahunan dikonversi menjadi bunga bulanan dan dipotong pajak 20% setiap bulan.</div>
      `;
      container.classList.remove('hidden');
    }

    /********
     * EVENT HANDLERS
     ********/
    function setupHandlers(){
      // formatter ribuan untuk input
      attachThousandHandlers();

      // Cordelia
      document.getElementById('btn-cordelia').addEventListener('click', () => {
        const tenor = Number(document.getElementById('cordelia-tenor').value || 0);
        const setoran = parseThousandInput(document.getElementById('cordelia-setoran'));
        const out = document.getElementById('cordelia-result');

        if(!tenor || !setoran){ alert('Mohon isi tenor dan setoran per bulan.'); return; }

        const {rows, ringkasan} = simulasiBulanan({
          setoranBulanan:setoran,
          tenorTahun:tenor,
          bungaTahunan:0.01,
          setoranAwal:0
        });
        renderTabel(out, rows, ringkasan);
      });

      // Elara tanpa setoran awal
      document.getElementById('btn-elara').addEventListener('click', () => {
        const tenor = Number(document.getElementById('elara-tenor').value || 0);
        const setoran = parseThousandInput(document.getElementById('elara-setoran'));
        const out = document.getElementById('elara-result');

        if(!tenor || !setoran){ alert('Mohon isi tenor dan setoran per bulan.'); return; }

        const {rows, ringkasan} = simulasiBulanan({
          setoranBulanan:setoran,
          tenorTahun:tenor,
          bungaTahunan:0.04,
          setoranAwal:0
        });
        renderTabel(out, rows, ringkasan);
      });

      // Elara dengan setoran awal
      document.getElementById('btn-elaraAwal').addEventListener('click', () => {
        const tenor = Number(document.getElementById('elaraAwal-tenor').value || 0);
        const setoranAwal = parseThousandInput(document.getElementById('elaraAwal-setoranAwal'));
        const setoran = parseThousandInput(document.getElementById('elaraAwal-setoran'));
        const out = document.getElementById('elaraAwal-result');

        if(!tenor || (!setoranAwal && !setoran)){ 
          alert('Mohon isi minimal salah satu: setoran awal atau setoran per bulan, serta tenor.');
          return; 
        }

        const {rows, ringkasan} = simulasiBulanan({
          setoranBulanan:setoran,
          tenorTahun:tenor,
          bungaTahunan:0.05,
          setoranAwal:setoranAwal
        });
        renderTabel(out, rows, ringkasan);
      });

      // Enter key = klik tombol pertama di form yang aktif
      ['form-cordelia','form-elara','form-elaraAwal'].forEach(fid=>{
        const sec = document.getElementById(fid);
        sec.addEventListener('keydown', (e)=>{
          if(e.key === 'Enter'){
            e.preventDefault();
            const btn = sec.querySelector('.btn-primary');
            if(btn) btn.click();
          }
        });
      });
    }

    // Init
    document.addEventListener('DOMContentLoaded', setupHandlers);
  </script>
</body>
</html>
